### REST Client Testing File
### Use this file with VS Code REST Client extension or similar tools

### Variables
@baseUrl = http://localhost:3000
@adminToken = YOUR_ADMIN_TOKEN_HERE
@userToken = YOUR_USER_TOKEN_HERE
@testEmail = test@example.com
@testPassword = password123
@testUsername = testuser123

### ============================================
### HEALTH CHECK
### ============================================

### Health Check
GET {{baseUrl}}/health

### ============================================
### EMAIL VERIFICATION SYSTEM
### ============================================

### 1. Register User (Auto-sends verification OTP)
POST {{baseUrl}}/auth/signup
Content-Type: application/json

{
  "username": "{{testUsername}}",
  "email": "{{testEmail}}",
  "password": "{{testPassword}}"
}

### 2. Check Verification Status
GET {{baseUrl}}/otp/verification-status/{{testEmail}}

### 3. Send Verification OTP (Manual)
POST {{baseUrl}}/otp/send-verification
Content-Type: application/json

{
  "email": "{{testEmail}}"
}

### 4. Verify Email with OTP
POST {{baseUrl}}/otp/verify-email
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "otp": "123456"
}

### 5. Try to Sign In Before Verification (Should fail)
POST {{baseUrl}}/auth/signin
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}"
}

### 6. Sign In After Verification (Should succeed)
POST {{baseUrl}}/auth/signin
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}"
}

### ============================================
### ADMIN AUTHENTICATION
### ============================================

### Admin Login
POST {{baseUrl}}/admin/login
Content-Type: application/json

{
  "email": "admin@company.com",
  "password": "AdminPassword123!"
}

### Admin Profile (Copy token from admin login)
GET {{baseUrl}}/admin/profile
Authorization: Bearer {{adminToken}}

### System Status (Admin only)
GET {{baseUrl}}/admin/system/status
Authorization: Bearer {{adminToken}}

### ============================================
### USER AUTHENTICATION
### ============================================

### User Signup (Requires verification)
POST {{baseUrl}}/auth/signup
Content-Type: application/json

{
  "username": "newuser123",
  "email": "newuser@example.com",
  "password": "password123"
}

### User Sign In (Blocked if not verified)
POST {{baseUrl}}/auth/signin
Content-Type: application/json

{
  "email": "john.doe@example.com",
  "password": "temp_password"
}

### User Profile (Copy token from signin)
GET {{baseUrl}}/auth/profile
Authorization: Bearer {{userToken}}

### ============================================
### USER MANAGEMENT (Admin Protected)
### ============================================

### Get All Users (Admin only)
GET {{baseUrl}}/users
Authorization: Bearer {{adminToken}}

### Get User by ID (Admin only)
GET {{baseUrl}}/users/1
Authorization: Bearer {{adminToken}}

### Create User (Admin only)
POST {{baseUrl}}/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "username": "adminuser123",
  "email": "adminuser@example.com",
  "password": "securepassword123",
  "role": "admin"
}

### Update User (Admin only)
PUT {{baseUrl}}/users/1
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "username": "updated_john",
  "email": "updated.john@example.com",
  "role": "admin"
}

### Delete User (Admin only)
DELETE {{baseUrl}}/users/1
Authorization: Bearer {{adminToken}}

### ============================================
### ERROR TESTING
### ============================================

### Invalid OTP
POST {{baseUrl}}/otp/verify-email
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "otp": "000000"
}

### Missing Email in OTP Request
POST {{baseUrl}}/otp/send-verification
Content-Type: application/json

{
  "wrongField": "{{testEmail}}"
}

### Non-existent User for OTP
POST {{baseUrl}}/otp/send-verification
Content-Type: application/json

{
  "email": "nonexistent@example.com"
}

### Sign In with Unverified Account
POST {{baseUrl}}/auth/signin
Content-Type: application/json

{
  "email": "jane.smith@example.com",
  "password": "temp_password"
}

### ============================================
### TESTING WORKFLOW INSTRUCTIONS
### ============================================

# üìß EMAIL VERIFICATION TESTING WORKFLOW:
#
# 1. SETUP EMAIL CONFIGURATION:
#    - Update .env with your Gmail credentials
#    - Use App Password for EMAIL_PASSWORD
#    - Set EMAIL_USER to your Gmail address
#
# 2. EMAIL VERIFICATION FLOW:
#    a) Register new user (auto-sends OTP)
#    b) Check email for OTP code
#    c) Verify email with OTP
#    d) Sign in successfully
#
# 3. ADMIN TESTING:
#    a) Login as admin
#    b) Manage users
#    c) Check system status
#
# 4. ERROR SCENARIOS:
#    - Invalid OTP codes
#    - Expired OTPs
#    - Unverified login attempts
#    - Missing required fields
#
# üìù NOTES:
# - Replace YOUR_ADMIN_TOKEN_HERE with actual token from admin login
# - Replace YOUR_USER_TOKEN_HERE with actual token from user signin
# - Update test variables at the top as needed
# - Check email inbox for OTP codes
# - OTPs expire in 10 minutes by default
# - Password reset functionality has been removed
